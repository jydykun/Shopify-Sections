{% javascript %}
(function () {

  /**
   * Initialize slider inside ONE section
   */
  function initSlider(section) {
    const slider = section.querySelector('.jdslider[data-tier="standard"]');
    if (!slider) return;

    // Prevent double init
    if (slider.swiper) return;

    // AUTOPLAY SETTINGS
    const AUTOPLAY = slider.dataset.autoplay === 'true';
    const AUTOPLAY_DELAY = parseInt(slider.dataset.autoplayDelay) || 3000;
    const PAUSE_ON_HOVER = slider.dataset.pauseOnHover === 'true';

    //PAGINATION SETTING
    const PAGINATION_RADIUS = 10; // DO NOT EDIT
    const PAGINATION_CIRCUMFERENCE = -(2 * Math.PI * PAGINATION_RADIUS);  //-62.83  Formula: C=2Ï€r 
    const CLICKABLE = slider.querySelector('.jdslider__pagination').dataset.clickable == 'true';

    const SPEED = parseInt(slider.dataset.speed) || 300;
    const EFFECT = slider.dataset.effect || 'slide';

    const swiper = new Swiper(slider, {
      effect: EFFECT,
      loop: true,
      speed: SPEED,
      autoplay: AUTOPLAY
      ? { 
          delay: AUTOPLAY_DELAY,
          pauseOnMouseEnter: PAUSE_ON_HOVER
        } 
      : false,

      navigation: {
        addIcons: false,
        nextEl: slider.querySelector('.jdslider__nav-button-next'),
        prevEl: slider.querySelector('.jdslider__nav-button-prev'),
      },

      pagination: {
        el: slider.querySelector('.jdslider__pagination'),
        type: 'bullets',
        bulletClass: 'jdslider__pagination-bullet',
        bulletActiveClass: 'jdslider__pagination-bullet--active',
        clickableClass: 'jdslider__pagination-bullet--clickable',
        clickable: CLICKABLE,
        renderBullet: function(index, className) {
          return `
            <button class="${className}">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="jdslider__pagination-progress">
                <circle cx="12" cy="12" r="${PAGINATION_RADIUS}"/>
              </svg>
            </button>
          `;s
        }
      },

      on: {
        autoplayTimeLeft(swiper, time, progress) {
          if (!this.pagination?.bullets) return;

          const bullet = this.pagination.bullets[this.realIndex];
          const circle = bullet?.querySelector('.jdslider__pagination-progress');
          if (!circle) return;

          circle.style.strokeDashoffset =
            PAGINATION_CIRCUMFERENCE * (1 - progress);
        },
      }
    });

    // Store instance directly on DOM element
    slider.jdSwiper = swiper;
  }

  /**
   * Destroy slider inside ONE section
   */
  function destroySlider(section) {
    const slider = section.querySelector('.jdslider[data-tier="standard"]');
    if (!slider || !slider.jdSwiper) return;

    slider.jdSwiper.destroy(true, true);
    slider.jdSwiper = null;
  }

  /**
   * Init on page load
   */
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.shopify-section').forEach(function (section) {
      initSlider(section);
    });
  });

  /**
   * Shopify Theme Editor Events
   */
  document.addEventListener('shopify:section:load', function (event) {
    initSlider(event.target);
  });

  document.addEventListener('shopify:section:unload', function (event) {
    destroySlider(event.target);
  });

})();
{% endjavascript %}
{% javascript %}
(function () {

  /**
   * Initialize slider inside ONE section
   */
  function initSlider(section) {
    const slider = section.querySelector('.jdslider[data-tier="standard"]');
    if (!slider) return;

    // Prevent double init
    if (slider.swiper) return;

    const AUTOPLAY = slider.dataset.autoplay === 'true';
    const AUTOPLAY_DELAY = parseInt(slider.dataset.autoplayDelay) || 3000;
    const PAUSE_ON_HOVER = slider.dataset.pauseOnHover === 'true';
    const SPEED = parseInt(slider.dataset.speed) || 300;
    const EFFECT = slider.dataset.effect || 'slide';

    const swiper = new Swiper(slider, {
      effect: EFFECT,
      loop: true,
      speed: SPEED,
      autoplay: AUTOPLAY
      ? { 
          delay: AUTOPLAY_DELAY,
          pauseOnMouseEnter: PAUSE_ON_HOVER
        } 
      : false,

      navigation: {
        nextEl: slider.querySelector('.swiper-button-next'),
        prevEl: slider.querySelector('.swiper-button-prev'),
      },

      on: {
        slideChangeTransitionStart: function () {
          console.log('Slide changed to: ', this.realIndex);
        },
      }
    });

    // Store instance directly on DOM element
    slider.jdSwiper = swiper;
    console.log(slider.swiper);
  }

  /**
   * Destroy slider inside ONE section
   */
  function destroySlider(section) {
    const slider = section.querySelector('.jdslider[data-tier="standard"]');
    if (!slider || !slider.jdSwiper) return;

    slider.jdSwiper.destroy(true, true);
    slider.jdSwiper = null;
  }

  /**
   * Init on page load
   */
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.shopify-section').forEach(function (section) {
      initSlider(section);
    });
  });

  /**
   * Shopify Theme Editor Events
   */
  document.addEventListener('shopify:section:load', function (event) {
    initSlider(event.target);
  });

  document.addEventListener('shopify:section:unload', function (event) {
    destroySlider(event.target);
  });

})();
{% endjavascript %}
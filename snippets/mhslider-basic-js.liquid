{% javascript %}
  (function () {
    // ----------------------------------------
    // Global namespace protection
    // ----------------------------------------
    window.MH = window.MH || {};

    /**
     * Singleton slider instance
     */
    MH.slider = null;
    MH.sliderEl = null;

    /**
     * Initialize ONE slider ONLY
     */
    MH.initSlider = function (slider) {
      // If already initialized, do nothing
      if (!slider || MH.slider) return;

      const AUTOPLAY_DELAY = 3000;
      const PAGINATION_CIRCUMFERENCE = -62.83;
      const paginationEl = slider.querySelector('.mhslider__pagination');

      const swiper = new Swiper(slider, {
        effect: 'slide',
        loop: true,

        autoplay: AUTOPLAY_DELAY
          ? {
              delay: AUTOPLAY_DELAY,
              disableOnInteraction: false,
              pauseOnMouseEnter: true,
            }
          : false,

        pagination: paginationEl
          ? {
              el: paginationEl,
              bulletClass: 'mhslider__pagination-bullet',
              bulletActiveClass: 'mhslider__pagination-bullet--active',
              clickable: true,
              clickableClass: 'mhslider__pagination-bullet--clickable',
              renderBullet(index, className) {
                return `
                <button class="${className}">
                  <svg viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="10"
                      class="mhslider__pagination-bullet-circle" />
                  </svg>
                </button>
              `;
              },
            }
          : false,

        on: {
          autoplayTimeLeft(swiper, time, progress) {
            const bullet = swiper.pagination?.bullets?.[swiper.realIndex];
            const circle = bullet?.querySelector('.mhslider__pagination-bullet-circle');
            if (circle) {
              circle.style.strokeDashoffset = PAGINATION_CIRCUMFERENCE * (1 - progress);
            }
          },
        },
      });

      // Store singleton
      MH.slider = swiper;
      MH.sliderEl = slider;
    };

    /**
     * Destroy the slider
     */
    MH.destroySlider = function () {
      if (!MH.slider) return;

      MH.slider.destroy(true, true);
      MH.slider = null;
      MH.sliderEl = null;
    };

    /**
     * Init first slider only
     */
    MH.init = function (container = document) {
      const slider = container.querySelector('.mhslider[data-tier="basic"]');
      if (slider) MH.initSlider(slider);
    };

    /**
     * Initial page load
     */
    document.addEventListener('DOMContentLoaded', () => {
      MH.init();
    });

    /**
     * Shopify Theme Editor Events
     */
    document.addEventListener('shopify:section:load', (event) => {
      MH.init(event.target);
    });

    document.addEventListener('shopify:section:unload', () => {
      MH.destroySlider();
    });
  })();
{% endjavascript %}
